<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="Simplify your code and life and avoid this mistakes."><meta property="og:type" content="article"><meta property="og:title" content="How NOT to use dictionaries in .NET Core"><meta property="og:url" content="https://www.codelime.blog/how-not-to-use-dictionaries-in-net-core/index.html"><meta property="og:site_name" content="Code Lime"><meta property="og:description" content="Simplify your code and life and avoid this mistakes."><meta property="og:locale" content="en"><meta property="og:image" content="https://www.codelime.blog/images/logo.png"><meta property="og:updated_time" content="2019-09-29T08:47:53.217Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="How NOT to use dictionaries in .NET Core"><meta name="twitter:description" content="Simplify your code and life and avoid this mistakes."><meta name="twitter:image" content="https://www.codelime.blog/images/logo.png"><link rel="shortcut icon" href="../images/favicon.ico"><link rel="icon" type="image/png" href="../images/favicon-192x192.png" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon.png"><title>How NOT to use dictionaries in .NET Core</title><link rel="stylesheet" href="../css/style.css"><link rel="stylesheet" href="../css/rtl.css"></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><header id="header"><a href="../index.html"><div id="logo" style="background-image:url(../images/logo.png)"></div><div id="title"><h1>Code Lime</h1></div></a><div id="nav"><ul><li class="icon"><a href="index.html#"><i class="fas fa-bars fa-2x"></i></a></li><li><a href="../index.html">Home</a></li><li><a href="../about/index.html">About</a></li><li><a href="../posts.html">Writing</a></li><li class="icon"></li> </ul></div></header><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">How NOT to use dictionaries in .NET Core</h1><div class="meta"><span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Code Lime</span></span><div class="postdate"><time datetime="2019-06-23T12:15:04.000Z" itemprop="datePublished">2019-06-23</time></div></div></header><div class="content" itemprop="articleBody"><p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.dictionary-2?view=netcore-2.2" target="_blank" rel="noopener">Dictionaries</a> are a popular and powerful implementation of the <a href="https://en.wikipedia.org/wiki/Hash_table" target="_blank" rel="noopener">hash table</a> data structure in .NET. Yet, I’ve come across cases where they are used improperly. Maybe <em>strangely</em> is a better word. Some might sound absurd for most of you, so would’ve been for me before I encounter them. Whilst writing the article I couldn’t believe I should make a case against them. At least I hope you’ll find the first two slightly amusing. I want to showcase these encounters here and offer a simple recommendation for each.</p><p>Dictionaries (or hash maps) in any programming language have the main benefit of offering quick, in constant complexity time, access to some value based on a key’s hash. You should then consider dictionaries when dealing with large collections of data and/or when needing to associate they key-value couple at runtime whilst subsequently needing to retrieve that value based on a key.</p><h2 id="1-As-DTOs"><a href="index.html#1-As-DTOs" class="headerlink" title="1. As DTOs"></a>1. As DTOs</h2><p>This is usually coupled with an <code>enum</code> defining what would be the properties. Below is the bad example.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// define the student properties</span></span><br><span class="line"><span class="keyword">enum</span> StudentProperty</span><br><span class="line">&#123;</span><br><span class="line">    Name,</span><br><span class="line">    University</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// code that creates the student</span></span><br><span class="line"><span class="keyword">var</span> student = <span class="keyword">new</span> Dictionary&lt;StudentProperty, <span class="keyword">string</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    &#123; StudentProperty.Name, <span class="string">"Jean"</span> &#125;,</span><br><span class="line">    &#123; StudentProperty.University, <span class="string">"UCLA"</span> &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">// code that uses the object</span></span><br><span class="line"><span class="keyword">string</span> name = student[StudentProperty.Name];</span><br><span class="line"><span class="keyword">string</span> university = student[StudentProperty.University];</span><br></pre></td></tr></table></figure><p>Considering performance, by using a dictionary you will create an array of keys larger than the values of the enum, you don’t really benefit of the fast retrieval because the number is so small.</p><p>Besides that, you have a hard time with (de)serialization and possibly forward mapping. And if you don’t want to do much type casting you can only have the values of the value type in that <code>Dictionary&lt;StudentProperty,string&gt;</code>, here it’s <code>string</code> and you can’t have any <code>int</code>s.</p><h2 id="Ditch-the-dictionary"><a href="index.html#Ditch-the-dictionary" class="headerlink" title="Ditch the dictionary"></a><em>Ditch the dictionary</em></h2><p>This must’ve been the case where you forgot about DTOs. A data Data Transfer Object (DTO) only has state (properties) and lacks behavior (no methods). This is useful for contracts between your application layers or external libraries.</p><p>Here’s a basic example:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// define the student class</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Student</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> University &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// code that creates the student</span></span><br><span class="line"><span class="keyword">var</span> student = <span class="keyword">new</span> Student</span><br><span class="line">&#123;</span><br><span class="line">    Name = <span class="string">"Scott"</span>,</span><br><span class="line">    University = <span class="string">"NYU"</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">// code that uses the object</span></span><br><span class="line"><span class="keyword">string</span> name = student.Name;</span><br><span class="line"><span class="keyword">string</span> university = student.University;</span><br></pre></td></tr></table></figure><p>The model for the student is known, the names and types of the properties are know. Using a plain class should be the natural choice, even if it’s for simplicity’s sake.</p><h2 id="2-As-lists-of-pairs"><a href="index.html#2-As-lists-of-pairs" class="headerlink" title="2. As lists of pairs"></a>2. As lists of pairs</h2><p>Say you need to pass some data around that so happens to have only two attributes. The uses case is just iteration and displaying the data. In a case of a student, the name and the course credits for that year. What collection do you choose. One would say <em>“Well, dictionaries are a collections of key-value pairs, easy-peasy.”</em>, and then would write something like this:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// code that creates or fetches data in this format</span></span><br><span class="line">Dictionary&lt;<span class="keyword">string</span>, <span class="keyword">int</span>&gt; studentsWithCredits = <span class="keyword">new</span> Dictionary&lt;<span class="keyword">string</span>, <span class="keyword">int</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    &#123; <span class="string">"Jean"</span>, <span class="number">28</span> &#125;,</span><br><span class="line">    &#123; <span class="string">"Scott"</span>, <span class="number">25</span> &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">// code that uses that data</span></span><br><span class="line"><span class="keyword">foreach</span>(KeyValuePair&lt;<span class="keyword">string</span>, <span class="keyword">int</span>&gt; student <span class="keyword">in</span> studentsWithCredits)</span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(<span class="string">$"<span class="subst">&#123;student.Key&#125;</span>: <span class="subst">&#123;student.Value&#125;</span>"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Now image you would get some information in a this data format from something a colleague wrote or a third party. Or you skim over this code month later. You’ll ask yourself what does a key represent and what does a value represent. Or suppose you just need a new attribute for the student.</p><p>Let’s not ignore the fact that this implementation does not make use of the hash tables fast retrieval characteristic.</p><h2 id="Again-ditch-the-dictionary"><a href="index.html#Again-ditch-the-dictionary" class="headerlink" title="Again, ditch the dictionary"></a><em>Again, ditch the dictionary</em></h2><p>What other collection of key-value pairs is out there. Well, a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.list-1?view=netcore-2.2" target="_blank" rel="noopener">list</a> of such pairs. You could have the generic type be <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.keyvaluepair-2?view=netcore-2.2" target="_blank" rel="noopener">KeyValuePair</a> type, write your own DTO type, but maybe more convenient use named <a href="https://docs.microsoft.com/en-us/dotnet/csharp/tuples" target="_blank" rel="noopener">tuples</a>. Therefore the code gets transformed into:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// code that creates the data </span></span><br><span class="line">List&lt;(<span class="keyword">string</span>, <span class="keyword">int</span>)&gt; studentsWithCredits = <span class="keyword">new</span> List&lt;(<span class="keyword">string</span>, <span class="keyword">int</span>)&gt;</span><br><span class="line">&#123;</span><br><span class="line">    ( <span class="string">"Jean"</span>, <span class="number">28</span> ),</span><br><span class="line">    ( <span class="string">"Scott"</span>, <span class="number">25</span> )</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">// code that uses that data</span></span><br><span class="line"><span class="keyword">foreach</span>((<span class="keyword">string</span> name, <span class="keyword">int</span> credits) student <span class="keyword">in</span> studentsWithGrades)</span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(<span class="string">$"<span class="subst">&#123;student.name&#125;</span>: <span class="subst">&#123;student.credits&#125;</span>"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Now any consumer knows better what this data is about, just a chain of values. And this is valid for <em>n</em>-values not just pairs. But don’t exaggerate with the <em>n</em> part. I’ve used here the <code>List</code> for the simple showcase type but you may want to take a look at <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.ienumerable-1?view=netcore-2.2" target="_blank" rel="noopener">IEnumerable</a> or <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.ireadonlycollection-1?view=netcore-2.2" target="_blank" rel="noopener">IReadOnlyCollection</a> to enforce immutability.</p><h2 id="3-As-Sets"><a href="index.html#3-As-Sets" class="headerlink" title="3. As Sets"></a>3. As Sets</h2><p>Here I’ll be more brief. In many cases it makes sense to use a dictionary thus I’ll try just to raise some awareness.</p><p>When you have some data that needs to be classified into two states only, instead of a <code>Dictionary&lt;T, bool&gt;</code> with boolean values, consider a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.hashset-1?view=netcore-2.2" target="_blank" rel="noopener">HashSet<t></t></a>. Everything in that set is in one of the states whilst the other fall into the other. The <code>HashSet</code> structure provides constant times for insertion and checking for existence.</p><h2 id="Final-words"><a href="index.html#Final-words" class="headerlink" title="Final words"></a>Final words</h2><p>Maybe these usages could be perfectly fine in some circumstances. The point of the article is to make you ask if it’s worth taking the long path when simple and clean ways are here for you.</p><div class="pagination"><a class="pag-anchor" href="../constructive-thoughts-after-a-failure/index.html"><i class="fas fa-angle-right pag-anchor">newer &gt</i></a></div></div></article><footer id="footer"><div class="footer-left">Copyright &copy; 2022 Randy Miller</div><div class="footer-right"><nav><ul><li><a href="../index.html">Home</a></li><li><a href="../about/index.html">About</a></li><li><a href="../posts.html">Writing</a></li><li><a href="https://twitter.com/randy_mllr">Twitter</a></li></ul></nav></div></footer></div><script>!function(t,e,a,c,n,o){e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},n=t.createElement("script"),o=t.getElementsByTagName("script")[0],n.async=1,n.src="//cdn.usefathom.com/tracker.js",n.id="fathom-script",o.parentNode.insertBefore(n,o)}(document,window,0,"fathom"),fathom("set","siteId","YFKINOVA"),fathom("trackPageview")</script></body></html>